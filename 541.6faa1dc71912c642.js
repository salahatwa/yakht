"use strict";(self.webpackChunkFastkart_Admin_SSR=self.webpackChunkFastkart_Admin_SSR||[]).push([[541],{1541:(x,A,e)=>{e.r(A),e.d(A,{WalletModule:()=>z});var c=e(6814),r=e(186),p=e(6505),d=e(7582),s=e(6223),m=e(3151),h=e(7310),y=e(8667);let g=(()=>{class o{static#t=this.type="[Wallet] Transaction Get";constructor(a){this.payload=a}}return o})(),f=(()=>{class o{static#t=this.type="[Wallet] Credit";constructor(a){this.payload=a}}return o})(),v=(()=>{class o{static#t=this.type="[Wallet] Debit";constructor(a){this.payload=a}}return o})();var M=e(9397),t=e(9212),W=e(3477),w=e(553),F=e(9862);let J=(()=>{class o{constructor(a){this.http=a}getUserTransaction(a){return this.http.get(`${w.N.URL}/wallet.json`,{params:a})}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(F.eN))};static#a=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),b=class _{constructor(i,a){this.notificationService=i,this.walletService=a}static wallet(i){return i.wallet}getUserTransations(i,{payload:a}){return this.walletService.getUserTransaction(a).pipe((0,M.b)({next:n=>{i.patchState({wallet:{consumer_id:n?.consumer_id,balance:n?.balance,transactions:{data:n?.transactions?.data,total:n?.transactions?.total?n?.transactions?.total:n?.transactions?.data?.length}}})},error:n=>{throw i.patchState({wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(n?.error?.message)}}))}credit(i,a){}debit(i,a){}static#t=this.\u0275fac=function(a){return new(a||_)(t.LFG(W.g),t.LFG(J))};static#a=this.\u0275prov=t.Yz7({token:_,factory:_.\u0275fac})};(0,d.gn)([(0,r.aU)(g)],b.prototype,"getUserTransations",null),(0,d.gn)([(0,r.aU)(f)],b.prototype,"credit",null),(0,d.gn)([(0,r.aU)(v)],b.prototype,"debit",null),(0,d.gn)([(0,r.Qf)()],b,"wallet",null),b=(0,d.gn)([(0,r.ZM)({name:"wallet",defaults:{wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],b);var U=e(9997),D=e(1427),L=e(7243),E=e(2879),N=e(3728),P=e(766),S=e(4274),G=e(9515),I=e(7999);const Q=["confirmationModal"];function B(o,i){if(1&o){const a=t.EpF();t.TgZ(0,"app-button",18),t.NdJ("click",function(){t.CHM(a);const l=t.oxw();return t.KtG(l.form.valid&&l.ConfirmationModal.openModal("credit"))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const a=t.oxw();t.Tol("btn btn-animation"),t.Q6J("disabled",!a.form.valid)("spinner",!1),t.xp6(1),t.hij(" ",t.lcZ(2,5,"add")," ")}}function O(o,i){if(1&o){const a=t.EpF();t.TgZ(0,"app-button",19),t.NdJ("click",function(){t.CHM(a);const l=t.oxw(),u=t.MAs(24);return t.KtG(+l.balance<+u.value||!!u.value&&l.ConfirmationModal.openModal("debit"))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const a=t.oxw(),n=t.MAs(24);t.Tol("btn btn-outline"),t.Q6J("spinner",!1)("disabled",+a.balance<+n.value||!n.value),t.xp6(1),t.hij(" ",t.lcZ(2,5,"withdraw")," ")}}const R=()=>[];class C{constructor(i,a,n,l){this.document=i,this.renderer=a,this.store=n,this.formBuilder=l,this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"amount",dataField:"amount",type:"price"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new y.jf({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new s.NI("",[s.kI.required]),balance:new s.NI("",[s.kI.required])}),this.form.controls.consumer_id.valueChanges.subscribe(u=>{u?(this.paginateInitialData.consumer_id=u,this.store.dispatch(new g(this.paginateInitialData)),this.wallet$.subscribe(T=>{let H=T?.transactions?.data?.filter(Z=>(Z.type_status=Z.type?`<div class="status-${Z.type}"><span>${Z.type.replace(/_/g," ")}</span></div>`:"-",Z));this.balance=T?T?.balance:0,this.tableConfig.data=T?H:[],this.tableConfig.total=T?T?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(i){this.paginateInitialData=i;let a=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=a,a&&this.store.dispatch(new g(i))}submit(i){this.form.markAllAsTouched();let a=new f(this.form.value);"debit"==i&&(a=new v(this.form.value)),this.form.valid&&this.store.dispatch(a).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}static#t=this.\u0275fac=function(a){return new(a||C)(t.Y36(c.K0),t.Y36(t.Qsj),t.Y36(r.yh),t.Y36(s.qu))};static#a=this.\u0275cmp=t.Xpm({type:C,selectors:[["app-wallet"]],viewQuery:function(a,n){if(1&a&&t.Gf(Q,5),2&a){let l;t.iGM(l=t.CRH())&&(n.ConfirmationModal=l.first)}},decls:33,vars:33,consts:[[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder","noResultMessage"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-wallet-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],["bal",""],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"dateRange","tableConfig","tableChanged"],[3,"confirmed"],["confirmationModal",""],[3,"disabled","spinner","click"],[3,"spinner","disabled","click"]],template:function(a,n){if(1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"form",2)(3,"app-page-wrapper",3),t._UZ(4,"select2",4),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"translate"),t.ALo(8,"translate"),t.qZA()()(),t.TgZ(9,"div",5)(10,"form",2)(11,"app-page-wrapper",3)(12,"div",6)(13,"div",7)(14,"div",8),t._UZ(15,"i",9),t.qZA(),t.TgZ(16,"div")(17,"h2"),t._uU(18),t.ALo(19,"currencySymbol"),t.qZA(),t.TgZ(20,"h5"),t._uU(21),t.ALo(22,"translate"),t.qZA()()(),t._UZ(23,"input",10,11),t.ALo(25,"translate"),t.TgZ(26,"div",12),t.YNc(27,B,3,7,"app-button",13)(28,O,3,7,"app-button",14),t.qZA()()()()()(),t.TgZ(29,"app-page-wrapper",3)(30,"app-table",15),t.NdJ("tableChanged",function(u){return n.onTableChange(u)}),t.qZA()(),t.TgZ(31,"app-confirmation-modal",16,17),t.NdJ("confirmed",function(u){return n.submit(null==u?null:u.actionToPerform)}),t.qZA()),2&a){let l;t.xp6(2),t.Q6J("formGroup",n.form),t.xp6(1),t.Q6J("gridClass","col-sm-12")("title","select_consumer"),t.xp6(1),t.s9C("noResultMessage",t.lcZ(8,24,"no_data_found")),t.Q6J("data",null!=(l=t.lcZ(5,18,n.users$))&&l.length?t.lcZ(6,20,n.users$):t.DdM(32,R))("placeholder",t.lcZ(7,22,"select_consumer")),t.xp6(6),t.Q6J("formGroup",n.form),t.xp6(1),t.Q6J("gridClass","col-sm-12")("title","wallet"),t.xp6(7),t.Oqu(t.lcZ(19,26,n.balance)),t.xp6(3),t.Oqu(t.lcZ(22,28,"wallet_balance")),t.xp6(2),t.s9C("placeholder",t.lcZ(25,30,"add_withdraw_amount")),t.xp6(4),t.Q6J("hasPermission","wallet.credit"),t.xp6(1),t.Q6J("hasPermission","wallet.debit"),t.xp6(1),t.Q6J("gridClass","col-sm-12")("title","transactions"),t.xp6(1),t.Q6J("dateRange",!0)("tableConfig",n.tableConfig)}},dependencies:[s._Y,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,U.ub,D.a,L.t,E.r,N.Y,P.N,S.A,c.Ov,G.X$,I.G]})}(0,d.gn)([(0,r.Ph)(h.a.users)],C.prototype,"users$",void 0),(0,d.gn)([(0,r.Ph)(b.wallet)],C.prototype,"wallet$",void 0),(0,d.gn)([(0,r.Ph)(m.f.setting)],C.prototype,"setting$",void 0);var Y=e(5419);const $=[{path:"",component:C,canActivate:[Y.n],data:{permission:"wallet.index"}}];let j=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#a=this.\u0275mod=t.oAB({type:o});static#e=this.\u0275inj=t.cJS({imports:[p.Bz.forChild($),p.Bz]})}return o})();var K=e(6208);let z=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#a=this.\u0275mod=t.oAB({type:o});static#e=this.\u0275inj=t.cJS({imports:[c.ez,j,K.m,r.$l.forFeature([h.a,b,m.f])]})}return o})()},5419:(x,A,e)=>{e.d(A,{n:()=>d});var c=e(9212),r=e(186),p=e(6505);let d=(()=>{class s{constructor(h,y){this.store=h,this.router=y}canActivate(h,y){const g=this.store.selectSnapshot(v=>v.account).permissions?.map(v=>v?.name),f=h.data?.permission;return!!(!f||!Array.isArray(f)&&g?.includes(f)||Array.isArray(f)&&f?.length&&f.every(v=>g?.includes(v)))||(this.router.navigate(["/error/403"]),!1)}static#t=this.\u0275fac=function(y){return new(y||s)(c.LFG(r.yh),c.LFG(p.F0))};static#a=this.\u0275prov=c.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})()},766:(x,A,e)=>{e.d(A,{N:()=>r});var c=e(9212);let r=(()=>{class p{constructor(s){this._el=s}onInputChange(s){const m=this._el.nativeElement.value;this._el.nativeElement.value=m.replace(/[^0-9]*/g,""),m!==this._el.nativeElement.value&&s.stopPropagation()}static#t=this.\u0275fac=function(m){return new(m||p)(c.Y36(c.SBq))};static#a=this.\u0275dir=c.lG2({type:p,selectors:[["input","numbersOnly",""]],hostBindings:function(m,h){1&m&&c.NdJ("input",function(g){return h.onInputChange(g)})}})}return p})()}}]);